@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //var perfil = "128";
    //var perfil = Request.QueryString["perfil"];
    var perfil = Session["perfil"];
    var idUsuario = Session["idUsuario"];
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <!-- Estilos de Bootstrap -->
    @*<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0/css/bootstrap.min.css">*@

    <!-- Estilos de DataTables -->
    @*<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css">*@
    <!-- JavaScript de jQuery (necesario para DataTables) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }

        /*Background color*/
        #grad1 {
            background-color: #f3f3f3;
        }

        .modalLoading {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(214, 214, 214, 0.8) url('../../Content/img/puntos.gif') 50% 50% no-repeat;
            background-size: 300px 240px;
        }

        /*Dropdown List Exp Date*/
        select.list-dt {
            border: none;
            outline: 0;
            border-bottom: 1px solid #ccc;
            padding: 2px 5px 3px 5px;
            margin: 2px;
        }

            select.list-dt:focus {
                border-bottom: 2px solid skyblue;
            }


        .button-container {
            display: flex; /* Utilizar flexbox para alinear los botones */
            justify-content: space-between; /* Espaciar uniformemente los botones */
        }

        .modalLoading {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(214, 214, 214, 0.8) url('../../Content/img/puntos.gif') 50% 50% no-repeat;
            background-size: 300px 240px;
        }

        .modal {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .nav-item {
            cursor: pointer; /* Cambia el cursor a una mano */
        }

        .grilla-btn {
            width: 150px;
            height: 40px;
            justify-content: center;
            align-items: center;
        }

        .cuadrado-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            line-height: 30px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress-bar {
            height: 40px; /* Ajusta la altura según sea necesario */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .btn-estado {
            background-color: #0086ca;
            color:white;
        }
            .btn-estado:hover,
            .btn-estado:focus,
            .btn-estado:active {
                background-color: #0086ca;
            }
        .btn-pdi {
            background-color: #95c100;
            color: white;
        }
            .btn-pdi:hover,
            .btn-pdi:focus,
            .btn-pdi:active {
                background-color: #95c100;
            }
        .btn-primary {
            background-color: #17AFB6;
        }

            .btn-primary:hover,
            .btn-primary:focus,
            .btn-primary:active {
                background-color: #17AFB6;
            }
        /*VIDEO*/
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

            .close:hover,
            .close:focus {
                color: black;
            }

        .modalV {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modalV-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fefefe;
            padding: 20px;
        }
        /*ESTILOS DE LA TABLA*/
        .jefe {
            background-color: #edfbaf !important;
        }

            .jefe:hover {
                background-color: #f0f0ee !important;
            }

        .propias {
            background-color: #cfdbe0 !important;
        }

            .propias:hover {
                background-color: #f1f1f0 !important;
            }

        /*SELECT2 ESTILOS*/
        /* Centrar verticalmente el texto en el cuadro de búsqueda */
        .select2-container .select2-search__field {
            font-size: 12px !important;
            color: rgba(214, 214, 214, 0.8) !important;
            line-height: 30px;
        }

        /* Centrar verticalmente el texto en el menú desplegable */
        .select2-container .select2-selection__rendered {
            font-size: 16px !important;
            color: #9d9797 !important;
            line-height: 30px;
        }

        /* Cambiar el tamaño del cuadro de selección */
        .select2-container--default .select2-selection--single {
            height: 40px !important;
        }

        /* Cambiar el color de fondo del menú desplegable */
        .select2-container .select2-dropdown {
            background-color: #f0f0f0 !important;
        }

        #progressbar {
            margin-bottom: 3vh;
            overflow: hidden;
            color: rgb(252, 103, 49);
            padding-left: 0px;
            margin-top: 3vh;
        }

            #progressbar li {
                list-style-type: none;
                font-size: small; /* Aumentar el tamaño de la fuente */
                width: 25%;
                float: left;
                position: relative;
                font-weight: 400;
                color: #17AFB6;
            }

            #progressbar #step1:before,
            #progressbar #step2:before,
            #progressbar #step3:before {
                content: "";
                color: #fff;
                width: 12px; /* Aumentar el ancho del círculo */
                height: 12px; /* Aumentar el alto del círculo */
                position: absolute; /* Cambiar a posición absoluta */
                top: 50%; /* Centrar verticalmente */
                transform: translateY(-50%); /* Ajustar para centrar perfectamente */
                border-radius: 50%; /* Hacer el círculo redondo */
                z-index: 2; /* Asegurar que los círculos estén encima de la barra */
            }

            #step1,
            #step2{
                height: 90px;
            }

            #progressbar #step1:before {
                margin-left: 0px !important;
            }

            #progressbar #step3:before {
                margin-right: 32%;
            }

            #progressbar #step4:before {
                margin-right: 0px !important;
                width: 12px; /* Aumentar el ancho del círculo */
                height: 12px; /* Aumentar el alto del círculo */
                position: absolute; /* Cambiar a posición absoluta */
                top: 50%; /* Centrar verticalmente */
                transform: translateY(-50%); /* Ajustar para centrar perfectamente */
                border-radius: 50%; /* Hacer el círculo redondo */
                z-index: 2; /* Asegurar que los círculos estén encima de la barra */
                padding-top: 20px;
            }

            #progressbar li:before {
                content: '';
                height: 4px; /* Aumentar el grosor de la barra */
                background: #ddd;
                position: absolute;
                left: 0%;
                right: 0%;
                margin-bottom: 2vh;
                top: 50%; /* Alinear verticalmente con los círculos */
                transform: translateY(-50%); /* Ajustar para centrar perfectamente */
                z-index: 1;
            }

            #progressbar li:after {
                content: '';
                height: 4px; /* Aumentar el grosor de la barra */
                background: #ddd;
                position: absolute;
                left: 0%;
                right: 0%;
                margin-bottom: 2vh;
                top: 50%; /* Alinear verticalmente con los círculos */
                transform: translateY(-50%); /* Ajustar para centrar perfectamente */
                z-index: 1;
            }

        .progress-track {
            padding: 0 8%;
            padding-top: 30px;
        }

        #progressbar li:nth-child(2):after {
            margin-right: auto;
        }

        #progressbar li:nth-child(1):after {
            margin: auto;
        }

        #progressbar li:nth-child(3):after {
            float: left;
            width: 68%;
        }

        #progressbar li:nth-child(4):after {
            margin-left: auto;
            width: 132%;
        }

        #progressbar li.active {
            color: black;
        }

            #progressbar li.active:before,
            #progressbar li.active:after {
                background: #17AFB6;
            }


        .fila-con-mano:hover {
            cursor: pointer;
            background-color: #17afb629;
        }

        .step-progress {
            width: 300px;
            position: relative;
            left: 10%;
        }

        .step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            height: 80px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #bbbbbb;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: #9f9f9f;
            font-weight: bold;
            position: relative;
            z-index: 1;
            margin-left: 20px;
        }

            .step-number::after {
                content: '';
                position: absolute;
                width: 14px;
                height: 14px;
                background-color: #bbbbbb;
                border-radius: 50%;
                z-index: 2;
            }

        .step.completed .step-number {
            border: 2px solid #4caf50;
            color: #4caf50;
        }

            .step.completed .step-number::after {
                background-color: #4caf50;
            }

        .step-description {
            font-size: 16px;
            color: #333;
            position: absolute;
            width: 180px;
        }

        .step-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .step-subtitle {
            font-size: 14px;
            color: #666;
        }

        .step-description.left {
            left: -170px;
        }

        .step-description.right {
            left: 70px;
        }

        .step::before {
            content: '';
            position: absolute;
            width: 4px;
            height: 100%;
            background-color: #ccc;
            left: 38px;
            top: 0;
            z-index: 0;
        }

        .step.completed::before {
            background-color: #4caf50;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 100%;
            background-color: #ccc;
            left: 38px;
            top: 50%;
            z-index: 0;
        }

        .step.completed:not(:last-child)::after {
            background-color: #4caf50;
        }

        .step:first-child::before {
            top: 50%;
        }

        .progressVertical {
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
    </style>


</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/progressbar.js/dist/progressbar.min.js"></script>

    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
        @if (Convert.ToInt32(perfil) == 127 || Convert.ToInt32(perfil) == 128)
        {
            <div style="margin-left: 2.5%; margin-block: 0.5%">
                <button id="instructivo" class="btn btn-secondary" onclick="DescargarInstructivo()" title="Instructivo" aria-label="Instructivo"> <i class=" fa fa-info-circle "></i></button>
                <button id="abrirModalBtn" class="btn btn-primary" title="Instructivo" aria-label="Instructivo"> <i class=" fa fa-video-camera"></i></button>
            </div>
        }
        @if (Convert.ToInt32(perfil) == 129)
        {
            <div style="margin-left: 2.5%; margin-block: 0.5%; position: relative;">
                <button id="instructivo" class="btn btn-secondary" onclick="DescargarInstructivo()" title="Instructivo" aria-label="Instructivo"> <i class="fa fa-info-circle"></i></button>
                <button id="abrirModalBtn" class="btn btn-primary" title="Instructivo" aria-label="Instructivo"> <i class="fa fa-video-camera"></i></button>
                <button id="altaPerformance" type="button" class="btn btn-block btn-warning" style="width: 200px; cursor: pointer;">
                    Alta Performance @(DateTime.Now.Year)
                </button>
                <input type="button" class="btn btn-estado boton" onclick="abrirModalFeedback()" title='Cambiar a estado 7' id="btnFeedback" value="Feedback Enviado ">
                <input type="button" class="btn btn-pdi boton" onclick="abrirModalPdi()" title='Carga de metas' id="btnPdi" value="PDI ">
                <input type="button" class="btn btn-success boton" onclick="GenerarExcelColaboradores()" title='excel' id="btnExcel" value="Reporte Performance ">
                <div class="tracking" id="progresoPerformance" style="margin-bottom: 20px; margin-left:480px">
                    <div class="text-uppercase text-xl font-weight-bolder opacity-7" id="tituloProgreso" style="width:auto">Progreso Performance @(DateTime.Now.Year)</div>
                </div>
                <div class="col-md-2" style="position: absolute; top: 10%; right: 2%; margin-right: 0px;">
                    <div class="d-flex flex-column p-3">
                        <div id="totalPendiente" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #7AC11F !important;"></span> Pendiente</div>
                        <div id="totalCompletado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #FFC107 !important;"></span> Completado</div>
                        <div id="totalEvaluado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #69E6FF !important;"></span> Evaluado</div>
                        <div id="totalFeedback" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #17AFB6 !important;"></span> Feedback</div>
                        <div id="totalFinalizado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #9b9b9b !important;"></span> Finalizado</div>
                    </div>
                </div>
            </div>
            <div class="row align-items-center" style="text-align: center; margin-top:20px; margin-left:15px;">
                <div class="form-group2 col-md-9">
                    <div class="progress" style="margin-bottom: 50px;">
                        <div id="barraPendiente" class="progress-bar progress-bar-stripeds" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraCompletado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraEvaluado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraFeedback" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraFinalizado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        }

        @*FILTROS SOLICITUDES*@

        <div class="row m-3" style="overflow: hidden; margin-top: 2% !important;" id="rowFiltro">
            @if (Convert.ToInt32(perfil) == 128 || Convert.ToInt32(perfil) == 129)
            {
                <div class="form-group2 col-md-2" id="filtroColaborador">
                    <label>Colaborador:</label>
                    <div></div>
                    <div style="font-weight: normal !important;">
                        <select class="form-control" id="selectColaborador"></select>
                    </div>
                </div>
                <div class="form-group2 col-md-2" id="filtroEstado">
                    <label>Estado:</label>
                    <div></div>
                    <select class="form-control" id="selectEstado">
                    </select>
                </div>
                <div class="form-group2 col-md-2" id="filtroAno">
                    <label>Año:</label>
                    <div></div>
                    <div style="font-weight: normal !important;">
                        <select class="form-control" id="selectAno"></select>
                    </div>
                </div>
                <div class="form-group2 col-md-2 mt-1 pt-4 d-flex" id="btnBuscarFiltro">
                    <button id="btnFiltrar" type="button" class="btn btn-success me-2" style="width: 120px; cursor: pointer;">
                        Buscar
                    </button>
                    <button id="btnLimpiar" type="button" class="btn btn-info" style="width: 120px; cursor: pointer;">
                        Limpiar
                    </button>
                </div>
                @*<div class="form-group2 col-md-1 mt-2" style="padding-top: 1.9%; margin-left:10px;" id="btnLimpiar">

                </div>*@
            }
        </div>
        <div class="row m-3" style="overflow: hidden; margin-top: 0% !important; display:none;" id="rowFiltro2">
            <div class="form-group2 col-md-2" id="filtroLider">
                <label>Líder:</label>
                <div></div>
                <div style="font-weight: normal !important;">
                    <select class="form-control" id="selectLider"></select>
                </div>
            </div>
            <div class="form-group2 col-md-2" id="filtroDominio">
                <label>Dominio:</label>
                <div></div>
                <div style="font-weight: normal !important;">
                    <select class="form-control" id="selectDominio"></select>
                </div>
            </div>
            <div class="form-group2 col-md-2" id="filtroConvenio">
                <label>Convenio:</label>
                <div></div>
                <div style="font-weight: normal !important;">
                    <select class="form-control" id="selectConvenio"></select>
                </div>
            </div>
        </div>

        <!-- MultiStep Form -->
        <div class="container-fluid py-4" id="grad1">
            <!-- TABLA COLABORADOR -->
            @if (Convert.ToInt32(perfil) == 127)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Colaborador</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-4">
                                    <table class="table align-items-center mb-0" id="tablaColaborador">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Líder</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Feedback</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                                @*
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Acciones</th>*@
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if (Convert.ToInt32(perfil) == 128)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Líder</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-4">
                                    <table class="table align-items-center mb-0" id="tablaLider">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Evaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Calibración</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                                @*
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Acciones</th>*@
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if (Convert.ToInt32(perfil) == 129)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Capital Humano</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-4">
                                    <table class="table align-items-center mb-0" id="tablaRRHH">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Líder</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Evaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Calibración</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Feedback</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        @*modal preguntar si esta seguro *@
        <div class="modal" id="modalAltas" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;"> Desea dar de alta las performance @(DateTime.Now.Year) de los colaboradores</p>
                    </div>
                    <div class="row mb-3 pr-2">
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-danger btn-sm btn-block" id="cerrarAlta" style="margin-left: 60%; width: 40%;">Cancelar</a>
                        </div>
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-info btn-sm btn-block" id="generarAlta" style="width: 40%;">Generar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*modal altas ok *@
        <div class="modal" id="modalAltasOk" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;">Se generaron las altas de performance @(DateTime.Now.Year) con éxito</p>
                    </div>
                </div>
            </div>
        </div>
        @*VIDEO*@
        <div id="videoModal" class="modalV">
            <div class="modalV-content">
                <span class="close" id="cerrarModalBtn">&times;</span>
                <video id="videoPlayer" controls width="560">
                    <source src="~/Content/img/Performance.mp4" type="video/mp4">
                    Tu navegador no soporta el tag de video.
                </video>
            </div>
        </div>
        <div class="modal" id="modalProgressBar" style="display: none!important; overflow-x: hidden; overflow-y:hidden; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px !important; max-height: 600px !important;">
                <div class="modal-content" style="">
                    <button type="button" class="btn-close text-dark" style="position: absolute; top: 0px; right: 10px; font-size: 1.5rem;" data-bs-dismiss="modal" aria-label="Close" onclick="CerrarModalHistorial();">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="tracking" style="width: 100%; text-align: center;">
                        <div class="step-title">Historial de Performance</div>
                    </div>
                    <div class="modal-body progressVertical" style="overflow-y: auto; max-height: 500px;">
                        <div id="historialBar" class="step-progress">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*modal preguntar si esta seguro de eliminar performance*@
        <div class="modal" id="modalDeseaEliminar" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;">¿Desea eliminar la Performance?</p>
                    </div>
                    <div class="row mb-3 pr-2">
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-info btn-sm btn-block" onclick="CerrarModalEliminar();" id="CerrarModalEnviar" style="margin-left: 60%; width: 40%;">Cancelar</a>
                        </div>
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-danger btn-sm btn-block" onclick="EliminarPerformance();" id="EliminarPErformance" style="width: 40%;">Eliminar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*modal preguntar si esta seguro cambiar a feedback*@
        <div class="modal" id="modalDeseaCambiarFeedback" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;">¿Desea cambiar todas las performance al estado Feedback Enviado?</p>
                    </div>
                    <div class="row mb-3 pr-2">
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-info btn-sm btn-block" onclick="CerrarModalCambiarFeedback();" style="margin-left: 60%; width: 40%;">Cancelar</a>
                        </div>
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-danger btn-sm btn-block" onclick="cambiarFeedback();" style="width: 40%;">Aceptar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*modal pdi*@
        <div class="modal" id="modalPdi" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 1400px!important;">
                <div class="modal-content p-2">
                    <div class="modal-dpi">

                        <div class="texto1" style="display:flex;">

                            <h1 class="h4" style="  font-size: 17px; font-family: Arial;  margin-top: 10px; margin-left:15px; ">Título de la meta:</h1>
                            <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-top: 10px; margin-left: 534px; ">Tipo de acción:</h1>
                            <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-top: 10px; margin-left: 235px; ">Habilidad:</h1>
                            
                        </div>

                        <div class="input1" style="display:flex;">

                            <input type="text" class="form-control requeridoPDI" id="metaT" maxlenght="100" style="padding:6px; border-radius:8px; border:1px solid rgba(214, 214, 214, 0.8); width:50%; margin-top:6px;margin-bottom:8px; margin-left:10px; " />

                            <select class="form-control requeridoPDI" id="selectTipoAccion" style="padding: 6px; border-radius: 8px; border: 1px solid rgba(214, 214, 214, 0.8); width: 25%; margin-top: 6px; margin-bottom: 8px; margin-left: 30px;"></select>

                            <select class="form-control requeridoPDI" id="selectHabilidad" style="padding: 6px; border-radius: 8px; border: 1px solid rgba(214, 214, 214, 0.8); width:25%; margin-top: 6px; margin-bottom: 8px; margin-left: 30px; margin-right:30px; "></select>

                        </div>

                        <p style="margin-left:15px;">0/100</p>

                        <div class="texto2" style="display:flex;">

                            <h1 class="h4" style="  font-size: 17px; font-family: Arial;  margin-top: 10px; margin-left:15px; ">Descripción de la meta:</h1>
                            <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-top: 10px; margin-left: 492px; ">Fecha desde:</h1>
                            <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-top: 10px; margin-left: 130px; ">Fecha hasta:</h1>
                            <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-top: 10px; margin-left: 135px; ">Status:</h1>

                        </div>

                        <div class="input2" style="display:flex;">

                            <input type="text" class="form-control requeridoPDI" id="metaD" maxlenght="200" style="padding:6px; border-radius:8px; border:1px solid rgba(214, 214, 214, 0.8); width:51%; margin-top:6px;margin-bottom:8px; margin-left:10px; " />
                            <input type="date" class="form-control requeridoPDI" id="fechaDesde" onblur="VerificarFechas()" style="font-family: Arial; padding:6px; border-radius:8px; border:1px solid rgba(214, 214, 214, 0.8); width:16%; margin-top:6px;margin-bottom:8px; margin-left:30px;" />
                            <input type="date" style="font-family: Arial; padding: 6px; border-radius: 8px; border: 1px solid rgba(214, 214, 214, 0.8); width: 16%; margin-top: 6px; margin-bottom: 8px; margin-left: 30px; " />
                            <select class="form-control requeridoPDI" id="selectStatus"  style="padding: 6px; border-radius: 8px; border: 1px solid rgba(214, 214, 214, 0.8); width:16%; margin-top: 6px; margin-bottom: 8px; margin-left: 30px; margin-right:30px; "> </select>

                        </div>

                        <p style="margin-left:15px;">0/200</p>


                        <h1 class="h4" style=" font-size: 17px; font-family: Arial; margin-right: 10px;margin-left:15px; ">Acciones realizadas:</h1>
                        <input type="text"  class="form-control" id="accionRealizada" maxlenght="500" style="padding: 6px; border-radius: 8px; border: 1px solid rgba(214, 214, 214, 0.8);margin-left:12px; width: 97%; margin-top: 6px; margin-bottom: 8px; " />
                        <p style="margin-left:15px;">0/500</p>

                </div>
                    <div class="row mb-3 pr-2">
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-danger btn-sm btn-block" onclick="CerrarModalPdi();" style="margin-left: 60%; width: 40%;">Cancelar</a>
                        </div>
                        <div class="col-md-6">
                                    <a href="#" role="button" class="btn btn-info btn-sm btn-block" onclick="ValidarDatosFaltantes();" id="guardarPDI" style="margin-left: 10%; width: 30%;">Guardar</a>
                                </div>
                    </div>
                </div>
            </div>
        </div>*
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- DataTables JS CDN -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <!-- JavaScript personalizado -->
    <script>
        
        var idUsuario = "@idUsuario";
        var perfil = "@perfil";
        var anoActual = new Date().getFullYear();
        var idPerformanceEliminar = 0;
        $("#divLoading").hide();
    //Codigo para checkbox
    const checkboxes = document.querySelectorAll('.form-check-input');

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', () => {
            checkboxes.forEach(otherCheckbox => {
                if (otherCheckbox !== checkbox) {
                    otherCheckbox.checked = false;
                }
            });
        });
    });
if(perfil == 129){
        $('#rowFiltro2').show();
        }
        $(document).ready(function () {
            CargarEstados();
            CargarAnos();
            ListarPerformance();
            CargarColaboradoresFiltro();
            CargarLideresFiltro();
            CargarDominiosFiltro();
            CargarConveniosFiltro();
            EstadoActual();
        });

    //Funcion para que ande el popover
    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();
    });
    //Active para navbar
    $(document).ready(function () {
        $('#navIndex').addClass('active');
    });

    ///FILTROS
        $('#btnFiltrar').click(function () {
            ListarPerformance();
        });
        $('#btnLimpiar').click(function () {
            LimpiarFiltros();
        });
        function LimpiarFiltros() {
            $('#selectColaborador').val('').trigger('change');
            $('#selectEstado').val('').trigger('change');
            $('#selectLider').val('').trigger('change');
            $('#selectAno').val('').trigger('change');
            $('#selectDominio').val('').trigger('change');
            $('#selectConvenio').val('').trigger('change');
            ListarPerformance();
        }
    ///LISTAR PERFORMANCE
        function ListarPerformance() {
            var colaborador = $("#selectColaborador").val();
            var estado = $("#selectEstado").val();
            var lider = $("#selectLider").val();
            var ano = $("#selectAno").val();
            var dominio = $("#selectDominio").val();
            var convenio = $("#selectConvenio").val();
            var url = "Api/PerformanceApp/ListarPerformance";
            url = url + "?idUsuario=" + "@idUsuario";
            url = url + "&idPerfil=" + "@perfil";
            url = url + "&colaborador=" + colaborador;
            url = url + "&estado=" + estado;
            url = url + "&lider=" + lider;
            url = url + "&ano=" + ano;
            url = url + "&dominio=" + dominio;
            url = url + "&convenio=" + convenio;

            if ("@perfil" == "127") {//Tabla del colaborador
                IniciarTabla();
                $('#tablaColaborador').DataTable().clear().destroy();
                CargarTablaColaborador(url);
            }
            if ("@perfil" == "128") {//Tabla del lider
                IniciarTablaLider();
                $('#tablaLider').DataTable().clear().destroy();
                CargartablaLider(url);
            }
            if ("@perfil" == "129") {//Tabla del RRHH
                IniciarTablaRRHH();
                $('#tablaRRHH').DataTable().clear().destroy();
                CargartablaRRHH(url);
                ListarProgreso();
            }
            $("#divLoading").show();
        }

        //INICIAR TABLA DEL COLABORADOR
        function IniciarTabla() {
            var table = $('#tablaColaborador').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
            table.clear().destroy();
        }
        function CargarTablaColaborador(url) {
            moment.locale('es');
            var table = $("#tablaColaborador").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": false,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);
                    },
                    "datatype": "json"
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "13%", "targets": 0 },
                    { "width": "20%", "targets": 1 },
                    { "width": "20%", "targets": 2 },
                    { "width": "13%", "targets": 3 },
                    { "width": "13%", "targets": 4 },
                    { "width": "20%", "targets": 5 },
                    /*{ "width": "10%", "targets": 6 },*/

                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombreJefe",
                        "name": "Líder",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaFeedback",
                        "name": "Fecha de Feedback",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            var currentDate = new Date();
                            var formattedDate = currentDate.getFullYear() +
                                ('0' + (currentDate.getMonth() + 1)).slice(-2) +
                                ('0' + currentDate.getDate()).slice(-2);
                            var secretKey = formattedDate + "12345678";
                            var iv = CryptoJS.lib.WordArray.random(16);
                            var encryptedIdPerformance = CryptoJS.AES.encrypt((row.idPerformance).toString(), CryptoJS.enc.Utf8.parse(secretKey), { iv: iv }).toString();
                            var ivBase64 = CryptoJS.enc.Base64.stringify(iv);
                            encryptedIdPerformance = encodeURIComponent(encryptedIdPerformance);
                            ivBase64 = encodeURIComponent(ivBase64);
                            //IF POR SI DE ALGUNA FORMA TRAE UNA PERFORMANCE ELIMINADA
                            if (row.eliminado) {
                                return '<div style="text-align: center;"><a class="btn btn-sm grilla-btn btn-danger" title="Performance Eliminada" style="font-size: 100% !important;">' + 'Eliminado' + '</a></div>';
                            }
                            if (data == 1) {
                                if (idEstadoActual == 1 && row.ano == anoActual) {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=autoevaluacion&idPerformance=' + encryptedIdPerformance + '&nombre=' + row.nombre + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                } else {
                                    return '<div style="text-align: center;"><a  href="#" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar fecha vencida" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                }
                            }
                            if (data == 2) {
                                if (row.fechaEvaluacion != null) {
                                    return '<div style="text-align: center;"><a href="#" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                } else {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                }
                            }
                            if (data == 3) {
                                return '<div style="text-align: center;"><a href="#" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="#" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                //return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="#" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                    //{
                    //    "data": "idEstado",
                    //    "name": "Acciones",
                    //    "autoWidth": false,
                    //    "render": function (data, type, row, meta) {
                    //        if (data == 2) {
                    //            return '<div style="text-align: center;" title="Descargar excel AutoEvaluación">' +
                    //                '<button class="btn btn-primary" onclick="GenerarExcelUnColaborador(' + row.idPerformance + ')"><i class="fas fa-cloud-download-alt"></i></button>' +
                    //                '</div>';
                    //        }
                    //        else {
                    //            return '';
                    //        }
                    //    }
                    //},
                ],
                "createdRow": function (row, data, index) {

                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };
        //INICIAR TABLA DEL LIDER
        function IniciarTablaLider() {
            $('#tablaLider').DataTable().clear().destroy();
            var table = $('#tablaLider').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
        }
        function CargartablaLider(url) {
            moment.locale('es');
            var table = $("#tablaLider").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": false,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);
                    },
                    "datatype": "json"
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "10%", "targets": 0 },
                    { "width": "20%", "targets": 1 },
                    { "width": "16%", "targets": 2 },
                    { "width": "16%", "targets": 3 },
                    { "width": "16%", "targets": 4 },
                    { "width": "20%", "targets": 5 },
                    /*{ "width": "10%", "targets": 6 },*/
                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año Performance",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaEvaluacion",
                        "name": "Fecha de Evaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaCalibracion",
                        "name": "Fecha de Calibración",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            var currentDate = new Date();
                            var formattedDate = currentDate.getFullYear() +
                                ('0' + (currentDate.getMonth() + 1)).slice(-2) +
                                ('0' + currentDate.getDate()).slice(-2);
                            var secretKey = formattedDate + "12345678";
                            var iv = CryptoJS.lib.WordArray.random(16);
                            var encryptedIdPerformance = CryptoJS.AES.encrypt((row.idPerformance).toString(), CryptoJS.enc.Utf8.parse(secretKey), { iv: iv }).toString();
                            var ivBase64 = CryptoJS.enc.Base64.stringify(iv);
                            encryptedIdPerformance = encodeURIComponent(encryptedIdPerformance);
                            ivBase64 = encodeURIComponent(ivBase64);
                            //IF POR SI DE ALGUNA FORMA TRAE UNA PERFORMANCE ELIMINADA
                            if (row.eliminado) {
                                return '<div style="text-align: center;"><a class="btn btn-sm grilla-btn btn-danger" title="Performance Eliminada" style="font-size: 100% !important;">' + 'Eliminado' + '</a></div>';
                            }
                            if (data == 1) {
                                if (idEstadoActual == 2 && row.ano == anoActual) {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                } else {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar, fecha vencida" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                }
                            }
                            if (data == 2) {
                                if (idEstadoActual == 2 && row.ano == anoActual) {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                } else {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación, fuera de etapa" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                }
                            }
                            if (data == 3) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                    //{
                    //    "data": "idEstado",
                    //    "name": "Acciones",
                    //    "autoWidth": false,
                    //    "render": function (data, type, row, meta) {
                    //        if (data == 2) {
                    //            return '<div style="text-align: center;" title="Descargar excel AutoEvaluación">' +
                    //                '<button class="btn btn-primary" onclick="GenerarExcelUnColaborador(' + row.idPerformance + ')"><i class="fas fa-cloud-download-alt"></i></button>' +
                    //                '</div>';
                    //        }
                    //        else {
                    //            return '';
                    //        }
                    //    }
                    //},
                ],
                "createdRow": function (row, data, index) {
                    // Aquí puedes aplicar estilos o clases a las filas según tus datos
                    $(row).addClass('fila-con-mano');
                    // evento click a las filas al crearlas
                    $(row).on('dblclick', function () {
                        var idPerformance = data.idPerformance;
                        CargarHistoria(idPerformance);
                    });
                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };

        //INICIAR TABLA RRHH
        function IniciarTablaRRHH() {
            var table = $('#tablaRRHH').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
            table.clear().destroy();
        }
        function CargartablaRRHH(url) {
            moment.locale('es');
            var table = $("#tablaRRHH").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": false,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);
                    },
                    "datatype": "json",
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "7%", "targets": 0 },
                    { "width": "15%", "targets": 1 },
                    { "width": "15%", "targets": 2 },
                    { "width": "5%", "targets": 3 },
                    { "width": "5%", "targets": 4 },
                    { "width": "5%", "targets": 5 },
                    { "width": "5%", "targets": 6 },
                    { "width": "10%", "targets": 7 },
                    { "width": "7%", "targets": 8 },
                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombreJefe",
                        "name": "Líder",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaEvaluacion",
                        "name": "Fecha de Evaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaCalibracion",
                        "name": "Fecha de Calibración",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaFeedback",
                        "name": "Fecha de Feedback",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            var currentDate = new Date();
                            var formattedDate = currentDate.getFullYear() +
                                ('0' + (currentDate.getMonth() + 1)).slice(-2) +
                                ('0' + currentDate.getDate()).slice(-2);
                            var secretKey = formattedDate + "12345678";
                            var iv = CryptoJS.lib.WordArray.random(16);
                            var encryptedIdPerformance = CryptoJS.AES.encrypt((row.idPerformance).toString(), CryptoJS.enc.Utf8.parse(secretKey), { iv: iv }).toString();
                            var ivBase64 = CryptoJS.enc.Base64.stringify(iv);
                            encryptedIdPerformance = encodeURIComponent(encryptedIdPerformance);
                            ivBase64 = encodeURIComponent(ivBase64);
                            if (row.eliminado) {
                                return '<div style="text-align: center;"><a class="btn btn-sm grilla-btn btn-danger" title="Performance Eliminada" style="font-size: 100% !important;">' + 'Eliminado' + '</a></div>';
                            }
                            if (@idUsuario == row.idUsuario) {
                                if (data == 1) {
                                    if (idEstadoActual == 1 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=autoevaluacion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                    if (idEstadoActual == 3 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=calibracion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar, calibrar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    } else {
                                        return '<div style="text-align: center;"><a href="#" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                }
                            } else {
                                if (data == 1) {
                                    if (idEstadoActual == 3 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=calibracion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar, calibrar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    } else {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                }
                            }
                            if (@idUsuario == row.idJefe) {
                                if (data == 2) {
                                    if (idEstadoActual == 2 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                    if (idEstadoActual == 3 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=calibracion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-warning" title="Evaluación sin realizar, calibrar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    } else {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación, fuera de etapa" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                }
                            } else {
                                if (data == 2) {
                                    if (idEstadoActual == 3 && row.ano == anoActual) {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=calibracion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-warning" title="Evaluación sin realizar, calibrar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    } else {
                                        return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                    }
                                }
                            }
                            if (data == 3) {
                                if (idEstadoActual == 3 && row.ano == anoActual) {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=calibracion&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada, calibrar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                } else {
                                    return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada, fuera etapa calibración" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                                }
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 7) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + encryptedIdPerformance + '&iv=' + ivBase64 + '" class="btn btn-sm grilla-btn btn-primary" title=" Hacer Encuesta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                    {
                        "data": "estado",
                        "name": "Acciones",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            var currentDate = new Date();
                            var formattedDate = currentDate.getFullYear() +
                                ('0' + (currentDate.getMonth() + 1)).slice(-2) +
                                ('0' + currentDate.getDate()).slice(-2);
                            var secretKey = formattedDate + "12345678";
                            var iv = CryptoJS.lib.WordArray.random(16);
                            var encryptedIdPerformance = CryptoJS.AES.encrypt((row.idPerformance).toString(), CryptoJS.enc.Utf8.parse(secretKey), { iv: iv }).toString();
                            var ivBase64 = CryptoJS.enc.Base64.stringify(iv);
                            encryptedIdPerformance = encodeURIComponent(encryptedIdPerformance);
                            ivBase64 = encodeURIComponent(ivBase64);
                            if (row.eliminado) {
                                return '';
                            }
                            if (row.idEstado == 3) {
                                return '<div style="display: flex; justify-content: center;">' +
                                    "<a href=# class='btn btn-sm btn-info cuadrado-btn' style='color:white;' title='Volver al Lider' id='btnVolverLider' onclick=\"CambiarEstado(" + row.idPerformance + "," + 2 + ")\"><i class='fa fa-reply'></i></a>" +
                                    "<a href=# class='btn btn-sm btn-danger cuadrado-btn' style='color:white;' title='Eliminar' id='btnEliminar' onclick=\"AbrirModalEliminar(" + row.idPerformance + ")\"><i class='fa fa-close'></i></a>" +
                                    "<a href='/PerformanceApp/Index/Crud?view=pdi&idPerformance=" + encryptedIdPerformance + "&iv=" + ivBase64 + "' class='btn btn-sm btn-info cuadrado-btn' style='color:white;' title='PDI'><i'>PDI</i></a>" +
                                    '</div>';
                            } else {
                                return '<div style="display: flex; justify-content: center;">' +
                                    "<a href=# class='btn btn-sm btn-danger cuadrado-btn' style='color:white;' title='Eliminar' id='btnEliminar' onclick=\"AbrirModalEliminar(" + row.idPerformance + ")\"><i class='fa fa-close'></i></a>" +
                                    "<a href='/PerformanceApp/Index/Crud?view=pdi&idPerformance=" + encryptedIdPerformance + "&iv=" + ivBase64 + "' class='btn btn-sm btn-info cuadrado-btn' style='color:white;' title='PDI'><i'>PDI</i></a>" +
                                    '</div>';
                            }

                        }
                    },
                ],
                "createdRow": function (row, data, index) {
                    $(row).removeClass();
                    if (data.idUsuario == "@idUsuario") {
                        $(row).addClass('propias');
                        $(row).removeClass('jefe');
                    }
                    if (data.idJefe == "@idUsuario") {
                        $(row).addClass('jefe');
                        $(row).removeClass('propias');
                    }
                    // Aquí puedes aplicar estilos o clases a las filas según tus datos
                    $(row).addClass('fila-con-mano');
                    // evento click a las filas al crearlas
                    $(row).on('dblclick', function () {
                        var idPerformance = data.idPerformance;
                        CargarHistoria(idPerformance);
                    });
                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };


        function CargarEstados() {
            var selecEstados = $('#selectEstado');
            selecEstados.empty();
            selecEstados.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/listarEstadosPerformance";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selecEstados.append($('<option/>', {
                            value: result.id,
                            text: result.estado
                        }));
                    });
                });
        }
        function CargarAnos() {
            var selecAnos = $('#selectAno');
            selecAnos.empty();
            selecAnos.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/listarAnosPerformance";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selecAnos.append($('<option/>', {
                            value: result.ano,
                            text: result.ano
                        }));
                    });
                });
        }
        @*var token = "";
        GenerarToken();
        function GenerarToken() {
            var url = "Api/PerformanceApp/EnviarMailLider?idUsuario=" + @idUsuario + "&idDestinatario=" + 2125;
            $.getJSON(url)
                .done(function (data) {
                });
        }*@

        function CargarColaboradoresFiltro() {
            var selectColaborador = $('#selectColaborador');
            selectColaborador.empty();
            selectColaborador.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarColaboradores";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectColaborador.append($('<option/>', {
                            value: result.idUsuario,
                            text: result.nombre
                        }));
                    });
                });
        }
        function CargarLideresFiltro() {
            var selectLider = $('#selectLider');
            selectLider.empty();
            selectLider.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarLideres";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectLider.append($('<option/>', {
                            value: result.idUsuario,
                            text: result.nombreJefe
                        }));
                    });
                });
        }
        function CargarDominiosFiltro() {
            var selectDominio = $('#selectDominio');
            selectDominio.empty();
            selectDominio.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarDominios";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectDominio.append($('<option/>', {
                            value: result.dominio,
                            text: result.dominio
                        }));
                    });
                });
        }
        function CargarConveniosFiltro() {
            var selectConvenio = $('#selectConvenio');
            selectConvenio.empty();
            selectConvenio.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarConvenios";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectConvenio.append($('<option/>', {
                            value: result.convenio,
                            text: result.convenio
                        }));
                    });
                });
        }
        $('#selectColaborador').select2({
            width: '100%',
        });
        $('#selectLider').select2({
            width: '100%',
        });
        $('#selectDominio').select2({
            width: '100%',
        });
        $('#selectConvenio').select2({
            width: '100%',
        });
        $('#selectAno').select2({
            width: '100%',
        });
        $('#selectEstado').select2({
            width: '100%',
        });

        ///ESTADOS DEFINIDOS

        var idEstadoActual = 0;
        function EstadoActual() {
            var url = "Api/PerformanceApp/EstadoActual";

            $.getJSON(url)
                .done(function (data) {

                    idEstadoActual = data;

                });
        }
        //ALTAS
        $('#altaPerformance').click(function () {
            $('#modalAltas').show();
        });
        $('#cerrarAlta').click(function () {
            $('#modalAltas').hide();
        });
        $('#generarAlta').click(function () {
            $.ajax({
                url: "/PerformanceApp/Api/PerformanceApp/GenerarAltasPerformance",
                type: 'GET',
                data: {

                },
                dataType: 'json',
                success: function (data) {
                    if (data > 0) {
                        $('#modalAltas').hide();
                        $('#modalAltasOk').show();
                        setTimeout(function () {
                            $('#modalAltasOk').hide();
                        }, 3000);
                        ListarPerformance();
                    } else {
                        alert('Error al generar las altas ' + data)
                        $('#modalAltas').hide();
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert("Error en la solicitud: " + errorThrown);
                }
            });

        });
        ///PROGRESO
        function ListarProgreso() {
           var url = "Api/PerformanceApp/ListarPerformanceProgreso";

            $.getJSON(url)
                .done(function (data) {
                    var datos = data[0];

                    var totalPendiente = datos.totalPendiente;
                    var totalCompletado = datos.totalCompletado;
                    var totalEvaluado = datos.totalEvaluado;
                    var totalFeedback = datos.totalFeedback;
                    var totalFinalizado = datos.totalFinalizado;

                    var porcentajePendiente = datos.porcentajePendiente;
                    var porcentajeCompletado = datos.porcentajeCompletado;
                    var porcentajeEvaluado = datos.porcentajeEvaluado;
                    var porcentajeFeedback = datos.porcentajeFeedback;
                    var porcentajeFinalizado = datos.porcentajeFinalizado;

                    var stylePendiente = "width: " + porcentajePendiente + "%; background-color: #FFC107"; // Verde
                    var styleCompletado = "width: " + porcentajeCompletado + "%; background-color: #7AC11F";     // Amarillo
                    var styleEvaluado = "width: " + porcentajeEvaluado + "%; background-color: #69E6FF";   // Azul
                    var styleFeedback = "width: " + porcentajeFeedback + "%; background-color: #17AFB6"; // gris
                    var styleFinalizado = "width: " + porcentajeFinalizado + "%; background-color: #9b9b9b"; // gris

                    // Configurar las barras de progreso con un ancho más grande
                    $("#barraPendiente").attr("style", stylePendiente).text(Math.round(porcentajePendiente) + "%");
                    $("#barraCompletado").attr("style", styleCompletado).text(Math.round(porcentajeCompletado) + "%");
                    $("#barraEvaluado").attr("style", styleEvaluado).text(Math.round(porcentajeEvaluado) + "%");
                    $("#barraFeedback").attr("style", styleFeedback).text(Math.round(porcentajeFeedback) + "%");
                    $("#barraFinalizado").attr("style", styleFinalizado).text(Math.round(porcentajeFinalizado) + "%");

                    //completo el total en las referencias
                    $("#totalPendiente").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #FFC107 !important;"></span> Pendiente: ' + totalPendiente);
                    $("#totalCompletado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #7AC11F !important;"></span> Completado: ' + totalCompletado);
                    $("#totalEvaluado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #69E6FF !important;"></span> Evaluado: ' + totalEvaluado);
                    $("#totalFeedback").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #17AFB6 !important;"></span> Feedback: ' + totalFeedback);
                    $("#totalFinalizado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #9b9b9b !important;"></span> Finalizado: ' + totalFinalizado);
                });
        }
        ////INSTRUCTIVO
        function DescargarInstructivo() {
            var url = 'Api/PerformanceApp/DescargarInstructivo';
            window.location.href = url;
        }
        ////REPORTES
        function GenerarExcelColaboradores() {
            var colaborador = $("#selectColaborador").val();
            var estado = $("#selectEstado").val();
            var lider = $("#selectLider").val();
            var ano = $("#selectAno").val();
            var url = 'Api/PerformanceApp/GenerarExcelReportesColaboradores';
            url = url + "?colaborador=" + colaborador;
            url = url + "&estado=" + estado;
            url = url + "&lider=" + lider;
            url = url + "&ano=" + ano;
            window.location.href = url;
        }
        function GenerarExcelUnColaborador(idPerformance) {
            var url = 'Api/PerformanceApp/GenerarExcelUnColaborador?idPerformance=' + idPerformance;
            window.location.href = url;
        }
        //VIDEO

        var modal = $('#videoModal');
        var abrirModalBtn = $('#abrirModalBtn');
        var videoPlayer = $('#videoPlayer');
        var cerrarModalBtn = $('#cerrarModalBtn');

        abrirModalBtn.click(function () {
            modal.css('display', 'block');
            videoPlayer.attr('src', '/Content/img/Performance.mp4');
            videoPlayer[0].play(); //reproduce automaticamente
        });

        modal.click(function (event) {
            if (event.target === modal[0]) {
                modal.css('display', 'none');
                videoPlayer[0].pause();
                videoPlayer.attr('src', '');
            }
        });
        cerrarModalBtn.click(function () {
            modal.css('display', 'none');
            videoPlayer[0].pause();
            videoPlayer.attr('src', '');
        });

        function AbrirModalEliminar(id) {
            $('#modalDeseaEliminar').show();
            idPerformanceEliminar = id;
        }
        function CerrarModalEliminar() {
            $('#modalDeseaEliminar').hide();
            idPerformanceEliminar = 0;
        }

        function EliminarPerformance() {
            // Realizar la solicitud AJAX
            var objeto = {};
            objeto.idPerformance = idPerformanceEliminar;
            objeto.idUsuario = @idUsuario;
            objeto.nombreUsuario = localStorage.getItem('nombreUsuario')
            $.ajax({
                type: "POST",
                url: "/PerformanceApp/Api/PerformanceApp/EliminarPerformance",
                data: objeto,
                dataType: "json",
                success: function (response) {
                    if (response == 0) {
                        // Error al guardar
                        alert("Error al eliminar la Performance");
                        console.log("Error al eliminar la Performance");
                    } else {
                        // Éxito al guardar
                        alert("Performance eliminada con éxito");
                        $('#modalDeseaEliminar').hide();
                        ListarPerformance();
                        //var url = "/PerformanceApp/Index?perfil=" + 0 + "&idUsuario=" + 0;
                        //window.location.href = url;
                    }
                },
                error: function (jqxhr) {
                    // Error en la solicitud AJAX
                    console.log("Error en la solicitud AJAX:", jqxhr);
                }
            });
        }

        //CAMBIAR ESTADO
        function CambiarEstado(idPerformance, estado) {
            var url = 'Api/PerformanceApp/CambiarEstado';
            url = url + "?idPerformance=" + idPerformance;
            url = url + "&estado=" + estado;
            url = url + "&idUsuario=" + @idUsuario;
            url = url + "&nombreUsuario=" + localStorage.getItem('nombreUsuario');

            $.getJSON(url)
                .done(function (data) {
                    ListarPerformance();
                });
        }

        //Historial
        function CerrarModalHistorial() {
            $('#progressbar').empty();
            $('#modalProgressBar').hide();
        }
        function CerrarModalHistorial() {
            $('#historialBar').empty();
            $('#modalProgressBar').hide();
        }
        function CargarHistoria(idPerformanceHistorial) {
            var url = "Api/PerformanceApp/listarHistorial?idPerformance=" + idPerformanceHistorial + "&idUsuario=" + @idUsuario;
            $('#modalProgressBar').show();
            var contador = 1;
            $.getJSON(url)
                .done(function (data) {
                    $.each(data, function (index, result) {
                        var item = '<div class="step completed">';
                        if (contador % 2 !== 0) { // Verificar si el contador es impar
                            item += '<div class="step-description left">' + '<div class="step-title">' + result.nombreUsuario + '</div>';
                            item += '<div class="step-subtitle">' + moment(result.fechaCambio).format("DD/MM/YYYY") + ' ' + result.estadoStr + '</div>';
                            item += "</div>";
                            item += '<div class="step-number">1</div>';
                            item += "</div>"
                        } else {
                            item += '<div class="step-description right">' + '<div class="step-title">' + result.nombreUsuario + '</div>';
                            item += '<div class="step-subtitle">' + moment(result.fechaCambio).format("DD/MM/YYYY") + ' ' + result.estadoStr + '</div>';
                            item += "</div>";
                            item += '<div class="step-number">1</div>';
                            item += "</div>"
                        }


                        $('#historialBar').append(item);

                        contador++;
                    });
                    if (data.length > 0) {
                        $('#historialBar').append('<div class="step"><div class="step-description left"></div ><div class="step-number">3</div></div>');
                    }

                });
        }

//CAMBIAR ESTADO FEEDBACK
function abrirModalFeedback() {
    $('#modalDeseaCambiarFeedback').show();
}
function CerrarModalCambiarFeedback() {
    $('#modalDeseaCambiarFeedback').hide();
}

//Pdi

        /*
        metaTitulo
        metaDescripcion
        fechaDesde
        fechaHasta
        accionesRealizadas
        */



        CargarStatus();
        function CargarStatus() {
            var selectStatus = $('#selectStatus');
            selectStatus.empty();
            selectStatus.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "/PerformanceApp/Api/PerformanceApp/ListarStatus";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectStatus.append($('<option/>', {
                            value: result.idStatus,
                            text: result.nombre
                        }));
                    });
                });
        }

        CargarHabilidades();
        function CargarHabilidades() {
            var selectHabilidad = $('#selectHabilidad');
            selectHabilidad.empty();
            selectHabilidad.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "/PerformanceApp/Api/PerformanceApp/ListarHabilidades";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectHabilidad.append($('<option/>', {
                            value: result.idHabilidad,
                            text: result.habilidad
                        }));
                    });
                });
        }


        CargarTiposAccion();
        function CargarTiposAccion() {
            var selectTipoAccion = $('#selectTipoAccion');
            selectTipoAccion.empty();
            selectTipoAccion.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "/PerformanceApp/Api/PerformanceApp/ListarTipoAccion";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectTipoAccion.append($('<option/>', {
                            value: result.idTipoAccion,
                            text: result.nombre
                        }));
                    });
                });
        }
        /*guardado*/
        ValidarDatosFaltantes();
        $('.requeridoPDI').each(function (index, element) {
            $('#' + element.id).on('change blur', function () {
                ValidarFaltantes();
            });
        });
        function ValidarFaltantes() {
            var elementos = $('.requeridoPDI');
            var validado = true;
            elementos.each(function (index, element) {
                if (element.value == '' || element.value == undefined) {
                    validado = false;
                } else {
                    element.style.backgroundColor = "";
                }
            });
        }
        function ValidarDatosFaltantes() {
            var elementos = $('.requeridoPDI');
            var validado = true;

            elementos.each(function (index, element) {
                if (element.value == '' || element.value == undefined) {
                    validado = false;
                    element.style.backgroundColor = "#ef8a99";
                }
            });
            if (validado) {
                GuardarMeta();
            } else {
                alert("Falta completar datos obligatorios");
            }
        }

        function GuardarMeta() {
            var metaDetalle = new Object();

            metaDetalle.idUsuario = idUsuario;
            metaDetalle.tipoAccion = $("#selectTipoAccion").val();
            metaDetalle.habilidad = $("#selectHabilidad").val();
            metaDetalle.metaTitulo = $("#metaT").val();
            metaDetalle.metaDescripcion = $("#metaD").val();
            metaDetalle.fechaDesde = $("#fechaDesde").val();
            metaDetalle.fechaHasta = $("#fechaHasta").val();
            metaDetalle.status = $("#selectStatus").val();
            metaDetalle.accionesRealizadas = $("#accionRealizada").val();

            $.ajax({
                type: "POST",
                url: "/PerformanceApp/Api/PerformanceApp/GuardarMeta",
                data: metaDetalle,
                dataType: "json",
                success: function (response) {
                    if (response == 0) {
                        mostrarMensajeGuardado();
                        CargarDatos();
                        vaciarMeta();
                    } else {
                        alet("Error al guardar");
                    }
                },
                error: function (jqxhr) {
                    //$('#modal-error').show();
                    console.log(jqxhr);
                }
            });
        }
        function mostrarMensajeGuardado() {
            $("#mensajeGuardado").fadeIn("slow", function () {
                setTimeout(function () {
                    $("#mensajeGuardado").fadeOut("slow");
                }, 3000);
            });
        }

        /*funciones*/
function abrirModalPdi() {
    $('#modalPdi').show();
}
function CerrarModalPdi() {
    $('#modalPdi').hide();
}
        /*feedback*/

 function cambiarFeedback(idPerformance, estado) {
     var url = 'Api/PerformanceApp/cambiarFeedback';
     url = url + "?idUsuario=" + @idUsuario;
    url = url + "&nombreUsuario=" + localStorage.getItem('nombreUsuario');
    $.getJSON(url)
        .done(function (data) {
            ListarPerformance();
            $('#modalDeseaCambiarFeedback').hide();
        });
}

    </script>

</body>
</html>
